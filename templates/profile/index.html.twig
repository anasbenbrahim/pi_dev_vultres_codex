{% extends 'base.html.twig' %}

{% block title %}Hello ProfileController!{% endblock %}
{% block footer%} {% endblock %}
{% block body %}

<style>
.offcanvas.offcanvas-end {
      top: 80px;
  
}
</style>





<div class="container-xxl flex-grow-1 container-p-y">
          
  <div class="row">
    <!-- User Sidebar -->
    <div class="col-xl-4 col-lg-5 order-1 order-md-0">
      <!-- User Card -->
      <div class="card mb-6">
        <div class="card-body pt-12">
          <div class="user-avatar-section">
            <div class=" d-flex align-items-center flex-column">

            {% if is_granted('ROLE_FERMIER') %}
              <img class="img-fluid rounded mb-4" src="../../assets/img/avatars/fermier.png" height="120" width="120" alt="User avatar">
            {% endif %}

            {% if is_granted('ROLE_Fournisseur') %}
              <img class="img-fluid rounded mb-4" src="../../assets/img/avatars/fournisseur.png" height="120" width="120" alt="User avatar">
            {% endif %}

            {% if is_granted('ROLE_CLIENTR') %}
              <img class="img-fluid rounded mb-4" src="../../assets/img/avatars/client.png" height="120" width="120" alt="User avatar">
            {% endif %}

            {% if is_granted('ROLE_SUPER_ADMIN') %}
              <img class="img-fluid rounded mb-4" src="../../assets/img/avatars/admin.png" height="120" width="120" alt="User avatar">
            {% endif %}


              <div class="user-info text-center">
                <h5><span class="mx-1">{{ user.firstName }}</span><span>{{ user.lastName }}</span></h5>
                <span class="badge bg-label-secondary">Author</span>
              </div>
            </div>
          </div>
         
          <h5 class="pb-4 border-bottom mb-4">Details</h5>
          <div class="info-container">
            <ul class="list-unstyled mb-6">
              <li class="mb-2">
                <span class="h6">FirstName:</span>
                <span>{{ user.firstName }}</span>
              </li>
              <li class="mb-2">
                <span class="h6">LastName:</span>
                <span>{{ user.lastName }}</span>
              </li>
              <li class="mb-2">
                <span class="h6">Email:</span>
                <span>{{ user.email }}</span>
              </li>
              <li class="mb-2">
              {% if is_granted('ROLE_FERMIER')%}
                <span class="h6">FarmName:</span>
                <span>{{ user.farmName }}</span>
              {% endif %}  
              {% if is_granted('ROLE_FOURNISSEUR') %}  
                <span class="h6">ConmanyName:</span>
                <span>{{ user.companyName }}</span>  
              {% endif %}
              </li>
            </ul>
            <div class="d-flex justify-content-center"> 
            {% if is_granted('ROLE_FERMIER') %}
              <a href="{{ path('superadmin_edit', {'id': user.id}) }}" class="btn btn-success me-4">Edit</a>
            {% endif %}  
            {% if is_granted('ROLE_Fournisseur')  %}
              <a href="{{ path('superadmin_edit', {'id': user.id}) }}" class="btn btn-success me-4">Edit</a>
            {% endif %}  
            </div>
          </div>
        </div>
      </div>
      <!-- /User Card -->
    
    </div>
    <!--/ User Sidebar -->

    <!-- User Content -->
    <div class="col-xl-8 col-lg-7 order-0 order-md-1">
      <!-- User Pills -->
     
      <!--/ User Pills -->

     

     
      <!-- Invoice table -->
<div class="card mb-4">
    <div class="card-body">
        <!-- Sales Dashboard Section -->
        <div class="container">
            <h1 class="mb-4 text-primary">Sales Dashboard</h1>
            
            <!-- Key Metrics Row -->
            <div class="row g-4 mb-4">
                <div class="col-12 col-md-6 col-lg-4">
                    <div class="card shadow-sm h-100">
                        <div class="card-body text-center">
                            <div class="d-flex align-items-center justify-content-center mb-3">
                                <i class="fas fa-euro-sign fa-2x text-primary me-3"></i>
                                <h5 class="card-title mb-0">Total Sales</h5>
                            </div>
                            <p class="display-6 fw-bold text-dark">{{ totalSales|format_currency('TND') }}</p>
                        </div>
                    </div>
                </div>
                
                <div class="col-12 col-md-6 col-lg-4">
                    <div class="card shadow-sm h-100">
                        <div class="card-body text-center">
                            <div class="d-flex align-items-center justify-content-center mb-3">
                                <i class="fas fa-chart-line fa-2x text-success me-3"></i>
                                <h5 class="card-title mb-0">Avg. Order Value</h5>
                            </div>
                            <p class="display-6 fw-bold text-dark">{{ avgOrderValue|format_currency('TND') }}</p>
                        </div>
                    </div>
                </div>

                <div class="col-12 col-md-6 col-lg-4">
                    <div class="card shadow-sm h-100">
                        <div class="card-body text-center">
                            <div class="d-flex align-items-center justify-content-center mb-3">
                                <i class="fas fa-cube fa-2x text-info me-3"></i>
                                <h5 class="card-title mb-0">Active Products</h5>
                            </div>
                            <p class="display-6 fw-bold text-dark">{{ activeProductsCount }}</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Charts Row -->
            <div class="row g-4 mb-4">
                <div class="col-12 col-lg-6">
                    <div class="card shadow-sm h-100">
                        <div class="card-body">
                            <h5 class="card-title mb-4 text-center text-secondary">
                                <i class="fas fa-chart-pie me-2"></i>Order Status Distribution
                            </h5>
                            <div class="chart-container" style="height: 300px; position: relative;">
                                <canvas id="orderStatusChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-12 col-lg-6">
                    <div class="card shadow-sm h-100">
                        <div class="card-body">
                            <h5 class="card-title mb-4 text-center text-secondary">
                                <i class="fas fa-chart-bar me-2"></i>Revenue by Product
                            </h5>
                            <div class="chart-container" style="height: 300px; position: relative;">
                                <canvas id="revenueChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Product Performance Section -->
            <div class="row g-4">
                <div class="col-12 col-lg-8">
                    <div class="card shadow-sm">
                        <div class="card-body">
                            <h5 class="card-title mb-4 text-center text-secondary">
                                <i class="fas fa-star me-2"></i>Top Selling Products
                            </h5>
                            <div class="table-responsive">
                                <table class="table table-hover table-striped">
                                    <thead class="table-light">
                                        <tr>
                                            <th scope="col">Product</th>
                                            <th scope="col" class="text-end">Quantity Sold</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for product in topSellingProducts %}
                                            <tr>
                                                <td>{{ product.name }}</td>
                                                <td class="text-end">{{ product.totalSold }}</td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Order Status Chart
    const statusCtx = document.getElementById('orderStatusChart').getContext('2d');
    new Chart(statusCtx, {
        type: 'pie',
        data: {
            labels: {{ orderStatusDistribution|map(o => o.status)|json_encode|raw }},
            datasets: [{
                data: {{ orderStatusDistribution|map(o => o.count)|json_encode|raw }},
                backgroundColor: [
                    '#4e73df', '#1cc88a', '#36b9cc', '#f6c23e'
                ],
                hoverOffset: 10
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        padding: 20
                    }
                }
            }
        }
    });

    // Revenue Chart
    const revenueCtx = document.getElementById('revenueChart').getContext('2d');
    new Chart(revenueCtx, {
        type: 'bar',
        data: {
            labels: {{ revenueByProduct|map(p => p.name)|json_encode|raw }},
            datasets: [{
                label: 'Revenue (TND)',
                data: {{ revenueByProduct|map(p => p.revenue)|json_encode|raw }},
                backgroundColor: '#4e73df',
                borderColor: '#2e59d9',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        callback: function(value) {
                             return value + ' TND';
                        }
                    }
                }
            },
            plugins: {
                legend: {
                    display: false
                }
            }
        }
    });
});
</script>
    </div>
    <!--/ User Content -->
  </div>

  <!-- Modal -->
  <!-- Edit User Modal -->
<div class="modal fade" id="editUser" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-simple modal-edit-user">
    <div class="modal-content">
      <div class="modal-body">
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        <div class="text-center mb-6">
          <h4 class="mb-2">Edit User Information</h4>
          <p>Updating user details will receive a privacy audit.</p>
        </div>
        <form class="row g-6" onsubmit="return false">
          <div class="col-12 col-md-6">
            <label class="form-label" for="modalEditUserFirstName">First Name</label>
            <input type="text" id="modalEditUserFirstName" name="modalEditUserFirstName" class="form-control" placeholder="John" value="John">
          </div>
          <div class="col-12 col-md-6">
            <label class="form-label" for="modalEditUserLastName">Last Name</label>
            <input type="text" id="modalEditUserLastName" name="modalEditUserLastName" class="form-control" placeholder="Doe" value="Doe">
          </div>
          <div class="col-12">
            <label class="form-label" for="modalEditUserName">Email</label>
            <input type="text" id="modalEditUserName" name="modalEditUserName" class="form-control" placeholder="johndoe007" value="johndoe007">
          </div>
          <div class="col-12 col-md-6">
            <label class="form-label" for="modalEditUserEmail">Email</label>
            <input type="text" id="modalEditUserEmail" name="modalEditUserEmail" class="form-control" placeholder="example@domain.com" value="example@domain.com">
          </div>
          
          <div class="col-12 col-md-6">
            <label class="form-label" for="modalEditUserEmail">Email</label>
            <input type="text" id="modalEditUserEmail" name="modalEditUserEmail" class="form-control" placeholder="example@domain.com" value="example@domain.com">
          </div>
          
          </div>
          <div class="col-12 text-center mb-3">
            <button type="submit" class="btn btn-success me-sm-3 me-1">Submit</button>
            <button type="reset" class="btn btn-label-secondary" data-bs-dismiss="modal" aria-label="Close">Cancel</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
<!--/ Edit User Modal -->

  <!-- Add New Credit Card Modal -->
<div class="modal fade" id="upgradePlanModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-simple modal-upgrade-plan">
    <div class="modal-content">
      <div class="modal-body">
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        <div class="text-center mb-6">
          <h4 class="mb-2">Upgrade Plan</h4>
          <p>Choose the best plan for user.</p>
        </div>
        <form id="upgradePlanForm" class="row g-4" onsubmit="return false">
          <div class="col-sm-9">
            <label class="form-label" for="choosePlan">Choose Plan</label>
            <select id="choosePlan" name="choosePlan" class="form-select" aria-label="Choose Plan">
              <option selected="">Choose Plan</option>
              <option value="standard">Standard - $99/month</option>
              <option value="exclusive">Exclusive - $249/month</option>
              <option value="Enterprise">Enterprise - $499/month</option>
            </select>
          </div>
          <div class="col-sm-3 d-flex align-items-end">
            <button type="submit" class="btn btn-primary">Upgrade</button>
          </div>
        </form>
      </div>
      <hr class="mx-5 my-2">
      <div class="modal-body">
        <p class="mb-0">User current plan is standard plan</p>
        <div class="d-flex justify-content-between align-items-center flex-wrap">
          <div class="d-flex justify-content-center me-2 mt-1">
            <sup class="h6 pricing-currency pt-1 mt-2 mb-0 me-1 text-primary fw-normal">$</sup>
            <h1 class="mb-0 text-primary">99</h1>
            <sub class="pricing-duration mt-auto mb-5 pb-1 small text-body">/month</sub>
          </div>
          <button class="btn btn-label-danger cancel-subscription">Cancel Subscription</button>
        </div>
      </div>
    </div>
  </div>
</div>
<!--/ Add New Credit Card Modal -->

  <!-- /Modal -->
        </div>
{% endblock %}
